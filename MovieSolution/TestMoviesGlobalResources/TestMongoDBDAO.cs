using Microsoft.VisualStudio.TestTools.UnitTesting;
using MoviesGlobalResources;

namespace TestMoviesGlobalResources
{
    [TestClass]
    public class TestMongoDBDAO
    {
        private MongoDBDAO _mongoDBDAO;
        private string _jsonTestDataInsert = "{\"page\":1,\"total_results\":2533,\"total_pages\":127,\"results\":[{\"popularity\":89.583,\"vote_count\":12530,\"video\":false,\"poster_path\":\"\\/btTdmkgIvOi0FFip1sPuZI2oQG6.jpg\",\"id\":11,\"adult\":false,\"backdrop_path\":\"\\/4iJfYYoQzZcONB9hNzg0J0wWyPH.jpg\",\"original_language\":\"en\",\"original_title\":\"Star Wars\",\"genre_ids\":[28,12,878],\"title\":\"Star Wars\",\"vote_average\":8.2,\"overview\":\"Princess Leia is captured and held hostage by the evil Imperial forces in their effort to take over the galactic Empire. Venturesome Luke Skywalker and dashing captain Han Solo team together with the loveable robot duo R2-D2 and C-3PO to rescue the beautiful princess and restore peace and justice in the Empire.\",\"release_date\":\"1977-05-25\"},{\"popularity\":397.129,\"vote_count\":1457,\"video\":false,\"poster_path\":\"\\/db32LaOibwEliAmSL2jjDF6oDdj.jpg\",\"id\":181812,\"adult\":false,\"backdrop_path\":\"\\/jOzrELAzFxtMx2I4uDGHOotdfsS.jpg\",\"original_language\":\"en\",\"original_title\":\"Star Wars: The Rise of Skywalker\",\"genre_ids\":[28,12,878],\"title\":\"Star Wars: The Rise of Skywalker\",\"vote_average\":6.7,\"overview\":\"The surviving Resistance faces the First Order once again as the journey of Rey, Finn and Poe Dameron continues. With the power and knowledge of generations behind them, the final battle begins.\",\"release_date\":\"2019-12-18\"},{\"popularity\":90.946,\"vote_count\":9504,\"video\":false,\"poster_path\":\"\\/kOVEVeg59E0wsnXmF9nrh6OmWII.jpg\",\"id\":181808,\"adult\":false,\"backdrop_path\":\"\\/5Iw7zQTHVRBOYpA0V6z0yypOPZh.jpg\",\"original_language\":\"en\",\"original_title\":\"Star Wars: The Last Jedi\",\"genre_ids\":[28,12,14,878],\"title\":\"Star Wars: The Last Jedi\",\"vote_average\":7,\"overview\":\"Rey develops her newly discovered abilities with the guidance of Luke Skywalker, who is unsettled by the strength of her powers. Meanwhile, the Resistance prepares to do battle with the First Order.\",\"release_date\":\"2017-12-13\"},{\"popularity\":93.991,\"vote_count\":4581,\"video\":false,\"poster_path\":\"\\/3IGbjc5ZC5yxim5W0sFING2kdcz.jpg\",\"id\":348350,\"adult\":false,\"backdrop_path\":\"\\/q1zsnEwcApz9AdMgV4nB0jrg1qg.jpg\",\"original_language\":\"en\",\"original_title\":\"Solo: A Star Wars Story\",\"genre_ids\":[28,12,878],\"title\":\"Solo: A Star Wars Story\",\"vote_average\":6.6,\"overview\":\"Through a series of daring escapades deep within a dark and dangerous criminal underworld, Han Solo meets his mighty future copilot Chewbacca and encounters the notorious gambler Lando Calrissian.\",\"release_date\":\"2018-05-15\"},{\"popularity\":66.243,\"vote_count\":13474,\"video\":false,\"poster_path\":\"\\/weUSwMdQIa3NaXVzwUoIIcAi85d.jpg\",\"id\":140607,\"adult\":false,\"backdrop_path\":\"\\/c2Ax8Rox5g6CneChwy1gmu4UbSb.jpg\",\"original_language\":\"en\",\"original_title\":\"Star Wars: The Force Awakens\",\"genre_ids\":[28,12,14,878],\"title\":\"Star Wars: The Force Awakens\",\"vote_average\":7.4,\"overview\":\"Thirty years after defeating the Galactic Empire, Han Solo and his allies face a new threat from the evil Kylo Ren and his army of Stormtroopers.\",\"release_date\":\"2015-12-15\"},{\"popularity\":24.436,\"vote_count\":6783,\"video\":false,\"poster_path\":\"\\/xPihqTMhCh6b8DHYzE61jrIiNMS.jpg\",\"id\":13475,\"adult\":false,\"backdrop_path\":\"\\/1XOSh6BFZbQ0xN75m4avqgzClyG.jpg\",\"original_language\":\"en\",\"original_title\":\"Star Trek\",\"genre_ids\":[28,12,878],\"title\":\"Star Trek\",\"vote_average\":7.4,\"overview\":\"The fate of the galaxy rests in the hands of bitter rivals. One, James Kirk, is a delinquent, thrill-seeking Iowa farm boy. The other, Spock, a Vulcan, was raised in a logic-based society that rejects all emotion. As fiery instinct clashes with calm reason, their unlikely but powerful partnership is the only thing capable of leading their crew through unimaginable danger, boldly going where no one has gone before. The human adventure has begun again.\",\"release_date\":\"2009-05-06\"},{\"popularity\":36.65,\"vote_count\":7017,\"video\":false,\"poster_path\":\"\\/wrFpXMNBRj2PBiN4Z5kix51XaIZ.jpg\",\"id\":332562,\"adult\":false,\"backdrop_path\":\"\\/mnDvPokXpvsdPcWSjNRPhiiLOKu.jpg\",\"original_language\":\"en\",\"original_title\":\"A Star Is Born\",\"genre_ids\":[18,10402,10749],\"title\":\"A Star Is Born\",\"vote_average\":7.5,\"overview\":\"Seasoned musician Jackson Maine discovers — and falls in love with — struggling artist Ally. She has just about given up on her dream to make it big as a singer — until Jack coaxes her into the spotlight. But even as Ally's career takes off, the personal side of their relationship is breaking down, as Jack fights an ongoing battle with his own internal demons.\",\"release_date\":\"2018-10-03\"},{\"popularity\":21.121,\"vote_count\":4529,\"video\":false,\"poster_path\":\"\\/mLrQMqyZgLeP8FrT5LCobKAiqmK.jpg\",\"id\":188927,\"adult\":false,\"backdrop_path\":\"\\/6uBlEXZCUHM15UNZqNig17VdN4m.jpg\",\"original_language\":\"en\",\"original_title\":\"Star Trek Beyond\",\"genre_ids\":[28,12,878],\"title\":\"Star Trek Beyond\",\"vote_average\":6.7,\"overview\":\"The USS Enterprise crew explores the furthest reaches of uncharted space, where they encounter a mysterious new enemy who puts them and everything the Federation stands for to the test.\",\"release_date\":\"2016-07-07\"},{\"popularity\":58.667,\"vote_count\":8789,\"video\":false,\"poster_path\":\"\\/n8V09dDc02KsSN6Q4hC2BX6hN8X.jpg\",\"id\":1893,\"adult\":false,\"backdrop_path\":\"\\/oFmzoKDMedABPpRBDVwr0aynSK1.jpg\",\"original_language\":\"en\",\"original_title\":\"Star Wars: Episode I - The Phantom Menace\",\"genre_ids\":[28,12,878],\"title\":\"Star Wars: Episode I - The Phantom Menace\",\"vote_average\":6.4,\"overview\":\"Anakin Skywalker, a young slave strong with the Force, is discovered on Tatooine. Meanwhile, the evil Sith have returned, enacting their plot for revenge against the Jedi.\",\"release_date\":\"1999-05-19\"},{\"popularity\":12.358,\"vote_count\":764,\"video\":false,\"poster_path\":\"\\/n4TpLWPi062AofIq4kwmaPNBSvA.jpg\",\"id\":201,\"adult\":false,\"backdrop_path\":\"\\/1SLR0LqYPU3ahXyPK9RZISjI3B7.jpg\",\"original_language\":\"en\",\"original_title\":\"Star Trek: Nemesis\",\"genre_ids\":[28,12,878,53],\"title\":\"Star Trek: Nemesis\",\"vote_average\":6.2,\"overview\":\"En route to the honeymoon of William Riker to Deanna Troi on her home planet of Betazed, Captain Jean-Luc Picard and the crew of the U.S.S. Enterprise receives word from Starfleet that a coup has resulted in the installation of a new Romulan political leader, Shinzon, who claims to seek peace with the human-backed United Federation of Planets. Once in enemy territory, the captain and his crew make a startling discovery: Shinzon is human, a slave from the Romulan sister planet of Remus, and has a secret, shocking relationship to Picard himself.\",\"release_date\":\"2002-12-13\"},{\"popularity\":10.592,\"vote_count\":335,\"video\":false,\"poster_path\":\"\\/eMbsUnRfRciBGLclsqmICPOXbir.jpg\",\"id\":12508,\"adult\":false,\"backdrop_path\":\"\\/7rBbIWriZUllqLabRYtN8O4tDTu.jpg\",\"original_language\":\"en\",\"original_title\":\"Rock Star\",\"genre_ids\":[35,18,10402],\"title\":\"Rock Star\",\"vote_average\":6.2,\"overview\":\"Rock Star tells the story of Chris Cole and a rock band called Steel Dragon. Cole is a photocopier technician by day, and the lead singer of a Steel Dragon tribute band called \\\"Blood Pollution\\\" by night.Internal struggles between the Steel Dragon band members culminate with the firing of the lead singer, Bobby Beers and the starting of recruitment sessions to find a new vocalist. Loosely inspired by the true story of the heavy metal band Judas Priest.\",\"release_date\":\"2001-09-04\"},{\"popularity\":12.419,\"vote_count\":1006,\"video\":false,\"poster_path\":\"\\/qhVB8eUGwkdVvd8Fezk0AgcMPDH.jpg\",\"id\":199,\"adult\":false,\"backdrop_path\":\"\\/welkOTUozJ968u1KLx33vPpo7aS.jpg\",\"original_language\":\"en\",\"original_title\":\"Star Trek: First Contact\",\"genre_ids\":[28,12,878,53],\"title\":\"Star Trek: First Contact\",\"vote_average\":7.2,\"overview\":\"The Borg, a relentless race of cyborgs, are on a direct course for Earth. Violating orders to stay away from the battle, Captain Picard and the crew of the newly-commissioned USS Enterprise E pursue the Borg back in time to prevent the invaders from changing Federation history and assimilating the galaxy.\",\"release_date\":\"1996-11-21\"},{\"popularity\":13.786,\"id\":152,\"video\":false,\"vote_count\":913,\"vote_average\":6.4,\"title\":\"Star Trek: The Motion Picture\",\"release_date\":\"1979-12-06\",\"original_language\":\"en\",\"original_title\":\"Star Trek: The Motion Picture\",\"genre_ids\":[878,12,9648],\"backdrop_path\":\"\\/w9iSKX1GSlaPPASW7jSFkFkkDnz.jpg\",\"adult\":false,\"overview\":\"When a destructive space entity is spotted approaching Earth, Admiral Kirk resumes command of the Starship Enterprise in order to intercept, examine, and hopefully stop it.\",\"poster_path\":\"\\/ys5Sgpc27mVo3H5zYLPV9LWDq5.jpg\"},{\"popularity\":41.065,\"vote_count\":10080,\"video\":false,\"poster_path\":\"\\/qjiskwlV1qQzRCjpV0cL9pEMF9a.jpg\",\"id\":330459,\"adult\":false,\"backdrop_path\":\"\\/wf6FHPjF0HGIIkxqzvBHA2XYef9.jpg\",\"original_language\":\"en\",\"original_title\":\"Rogue One: A Star Wars Story\",\"genre_ids\":[28,12,878],\"title\":\"Rogue One: A Star Wars Story\",\"vote_average\":7.5,\"overview\":\"A rogue band of resistance fighters unite for a mission to steal the Death Star plans and bring a new hope to the galaxy.\",\"release_date\":\"2016-12-14\"},{\"popularity\":16.352,\"vote_count\":261,\"video\":false,\"poster_path\":\"\\/tEbDvivUfsCupngKIfMJJ725eAD.jpg\",\"id\":355547,\"adult\":false,\"backdrop_path\":\"\\/orpnKsu7t1CLDNYgzevgsz67xRq.jpg\",\"original_language\":\"en\",\"original_title\":\"The Star\",\"genre_ids\":[12,16,35,14,10751],\"title\":\"The Star\",\"vote_average\":5.6,\"overview\":\"A small but brave donkey and his animal friends become the unsung heroes of the greatest story ever told, the first Christmas.\",\"release_date\":\"2017-11-15\"},{\"popularity\":22.014,\"id\":54138,\"video\":false,\"vote_count\":6547,\"vote_average\":7.3,\"title\":\"Star Trek Into Darkness\",\"release_date\":\"2013-05-05\",\"original_language\":\"en\",\"original_title\":\"Star Trek Into Darkness\",\"genre_ids\":[28,12,878],\"backdrop_path\":\"\\/ns0IojuqJe24AHTxe8RVcWJUCDM.jpg\",\"adult\":false,\"overview\":\"When the crew of the Enterprise is called back home, they find an unstoppable force of terror from within their own organization has detonated the fleet and everything it stands for, leaving our world in a state of crisis.  With a personal score to settle, Captain Kirk leads a manhunt to a war-zone world to capture a one man weapon of mass destruction. As our heroes are propelled into an epic chess game of life and death, love will be challenged, friendships will be torn apart, and sacrifices must be made for the only family Kirk has left: his crew.\",\"poster_path\":\"\\/41mhrXASAW3sdn7LBWF49uCX0xi.jpg\"},{\"popularity\":11.68,\"vote_count\":639,\"video\":false,\"poster_path\":\"\\/7m253YYciU4BjFUU1fxi2yL5Cgv.jpg\",\"id\":200,\"adult\":false,\"backdrop_path\":\"\\/yaattgmMQ9dLg6n8XPXAER8WI2C.jpg\",\"original_language\":\"en\",\"original_title\":\"Star Trek: Insurrection\",\"genre_ids\":[28,12,878,53],\"title\":\"Star Trek: Insurrection\",\"vote_average\":6.4,\"overview\":\"When an alien race and factions within Starfleet attempt to take over a planet that has \\\"regenerative\\\" properties, it falls upon Captain Picard and the crew of the Enterprise to defend the planet's people as well as the very ideals upon which the Federation itself was founded.\",\"release_date\":\"1998-12-10\"},{\"popularity\":8.816,\"vote_count\":247,\"video\":false,\"poster_path\":\"\\/dMo0ToyAlicDeSNmY47vZkbrRIK.jpg\",\"id\":29963,\"adult\":false,\"backdrop_path\":\"\\/bfC8sfsHImqXWO1WHJJWIhWXEbo.jpg\",\"original_language\":\"en\",\"original_title\":\"Bright Star\",\"genre_ids\":[18,10749],\"title\":\"Bright Star\",\"vote_average\":6.7,\"overview\":\"In 1818, high-spirited young Fanny Brawne finds herself increasingly intrigued by the handsome but aloof poet John Keats, who lives next door to her family friends the Dilkes. After reading a book of his poetry, she finds herself even more drawn to the taciturn Keats. Although he agrees to teach her about poetry, Keats cannot act on his reciprocated feelings for Fanny, since as a struggling poet he has no money to support a wife.\",\"release_date\":\"2009-11-05\"},{\"popularity\":10.536,\"vote_count\":156,\"video\":false,\"poster_path\":\"\\/eSuuTqr5wmzWu4OCS51Qw0q6VrV.jpg\",\"id\":26748,\"adult\":false,\"backdrop_path\":\"\\/jAWu7vxLOIiDwskIXnF8zqtCnRw.jpg\",\"original_language\":\"en\",\"original_title\":\"Lone Star\",\"genre_ids\":[18,9648,10749],\"title\":\"Lone Star\",\"vote_average\":7.1,\"overview\":\"When the skeleton of his murdered predecessor is found, Sheriff Sam Deeds unearths many other long-buried secrets in his Texas border town.\",\"release_date\":\"1996-06-21\"},{\"popularity\":38.295,\"vote_count\":8231,\"video\":false,\"poster_path\":\"\\/tgr5Pdy7ehZYBqBkN2K7Q02xgOb.jpg\",\"id\":1895,\"adult\":false,\"backdrop_path\":\"\\/wUYTfFbfPiZC6Lcyt1nonr69ZmK.jpg\",\"original_language\":\"en\",\"original_title\":\"Star Wars: Episode III - Revenge of the Sith\",\"genre_ids\":[28,12,878],\"title\":\"Star Wars: Episode III - Revenge of the Sith\",\"vote_average\":7.3,\"overview\":\"The evil Darth Sidious enacts his final plan for unlimited power -- and the heroic Jedi Anakin Skywalker must choose a side.\",\"release_date\":\"2005-05-17\"}]}";

        [TestInitialize]
        public void Setup()
        {
            _mongoDBDAO = new MongoDBDAO();
            _mongoDBDAO.SetupTest();
        }

        private void InsertTestMovies()
        {
            foreach (var movie in JsonHelper.GetMoviesJArrayFromRawJson(_jsonTestDataInsert))
            {
                _mongoDBDAO.InsertMovie(movie.ToString());
            }
        }

        [TestMethod]
        public void TestInsertMovie()
        {
            InsertTestMovies();
        }


        [TestMethod]
        public void TestGetMovie()
        {
            InsertTestMovies();
            var film1 = _mongoDBDAO.GetMovie(11);//id exists
            Assert.AreNotEqual(film1, null);
            var film2 = _mongoDBDAO.GetMovie(1231231231);//id not exists
            Assert.AreEqual(film2, null);
        }

        [TestMethod]
        public void TestFindMovies()
        {
            InsertTestMovies();
            var film1 = _mongoDBDAO.FindMovies("Star Wa");//name exists
            Assert.AreNotEqual(film1.Count, 0);
            var film2 = _mongoDBDAO.FindMovies("Star Wa123");//name not exists
            Assert.AreEqual(film2.Count, 0);
        }

    }
}
